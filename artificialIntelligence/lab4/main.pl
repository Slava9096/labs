:- dynamic(известно/1).
:- dynamic(ответ/1).

правило(1, 'Удалите неиспользуемые ресурсы', 
        [высокая_стоимость_счетов, неактивные_инстансы_обнаружены]).
правило(2, 'Используйте резервные инстансы', 
        [постоянная_нагрузка_на_сервер, высокая_стоимость_счетов]).
правило(3, 'Настройте автоматическое масштабирование', 
        [перегрузки_при_пиковой_нагрузке, низкая_производительность_приложений]).
правило(4, 'Оптимизируйте базы данных', 
        [медленные_запросы_к_БД, высокая_нагрузка_на_диски]).
правило(5, 'Перейдите на более дешевый регион', 
        [высокая_стоимость_счетов, отсутствие_привязки_к_региону]).
правило(6, 'Внедрите кэширование', 
        [долгая_загрузка_статики, высокая_нагрузка_на_сервер]).
правило(7, 'Обновите политики безопасности', 
        [обнаружены_уязвимости, устаревшие_версии_сервисов]).
правило(8, 'Используйте CDN', 
        [низкая_скорость_для_удаленных_пользователей, высокая_нагрузка_на_сервер]).
правило(9, 'Оптимизируйте код приложений', 
        [высокая_загрузка_CPU, частые_таймауты_запросов]).
правило(10, 'Настройте мониторинг ресурсов', 
        [непредсказуемые_сбои, отсутствие_данных_о_нагрузке]).

рекомендовать(Рекомендация) :-
    правило(_Номер, Рекомендация, Симптомы), 
    проверить(Симптомы),
    объяснить(Рекомендация).

проверить([]).
проверить([Симптом|Остальные]) :-
    симптом(Симптом),
    проверить(Остальные).

симптом(Симптом) :-
    известно(Симптом), !.
симптом(Симптом) :-
    \+ известно(Симптом),
    задать_вопрос(Симптом),
    (ответ(да) ->
         assertz(известно(Симптом))
    ;
         assertz(известно(не(Симптом))),
         fail).

задать_вопрос(Симптом) :-
    format('~w? (1 - нет, 2 - да) ', [Симптом]),
    read(Num),
    ( Num = 2 ->
         Ответ = да
    ; Num = 1 ->
         Ответ = нет
    ; write('Неверный ввод. Попробуйте еще раз.'), nl,
      задать_вопрос(Симптом)
    ),
    retractall(ответ(_)),
    assertz(ответ(Ответ)),
    (Ответ = да ; Ответ = нет).

объяснить(Рекомендация) :-
    format('~n== Рекомендация ==~n'),
    format('Действие: ~w~n', [Рекомендация]).

начать :-
    retractall(известно(_)),
    retractall(ответ(_)),
    writeln('Добро пожаловать в систему оптимизации облачных ресурсов!'),
    (рекомендовать(_) ->
         true
    ;
         writeln('Не удалось провести оптимизацию')),
    writeln('Анализ завершен.').
